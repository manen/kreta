<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="/styles.css" />
		<title>kreta -> naptar</title>
	</head>
	<body>
		<code class="title">
			<h1 class="title-inner">timetable-to-ical</h1>
		</code>

		<p>
			a <code>timetable-to-ical</code> használatával pár gombnyomással
			importálhatod a valós idejű órarendedet a krétádból a naptáradba.
			funkciók:
		</p>
		<ul>
			<li>óra nevének mutatása</li>
			<li>terem neve/száma</li>
			<li>órát tartó tanár neve</li>
			<li>óra témája</li>

			<li>helyettesítés, bejelentett dolgozat jelzése emojival</li>
			<li>óráról késés, hiányzás jelzése emojival</li>
		</ul>

		<p>
			az egész projekt rust-ban készült, a forráskód fejestül mindenestül
			elérhető a <a href="https://github.com/manen/kreta">githubomon</a>.
		</p>

		<hr />

		<p>hozzáadás a naptárhoz:</p>
		<form id="loginForm">
			<div id="login-grid">
				<label> Felhasználónév / Oktatási azonosító (7xxxxxxxxxx): </label>
				<input type="text" id="username" required pattern="7\d*" />
				<label> Jelszó: </label>
				<input type="password" id="password" required />
				<label> Intézmény azonosítója (https://xxxxxxx.e-kreta.hu): </label>
				<input type="text" id="institution" required />
			</div>

			<div class="row">
				<div>
					Az órarendlekérdezés típusa
					<p class="with_margin">
						timetable: egyszerű, 1 hónapos intervallum (2 hét előre, 2 hét
						hátra), néhány adatot (pl.: dolgozat témája, házifeladat szövege)
						nem tartalmaz, de csak 1 kérelmet küld a kréta szervereknek. a
						házifeladatot a feladás napjához mutatja
					</p>
					<p class="with_margin">
						combine: az órarend, dolgozatok és házifeladatok összessége, 3 hét
						előre, 3 hét hátra. több információt tartalmaz, ezzel több kérelmet
						is küld a kréta szerverekhez(!). a házifeladatot a határidő napjához
						mutatja
					</p>
				</div>
				<select id="timetable-type">
					<option value="timetable">egyszerű timetable</option>
					<option value="combine" selected>combine</option>
				</select>
			</div>

			<button type="submit">órarend hozzáadása a naptárhoz</button>

			<script>
				const form = document.getElementById("loginForm");

				form.addEventListener("submit", async (event) => {
					event.preventDefault();

					const username = document.getElementById("username").value;
					const password = document.getElementById("password").value;
					const inst_id = document.getElementById("institution").value;
					const timetable_type =
						document.getElementById("timetable-type").value;

					const output = document.getElementById("output");

					output.innerHTML = "mindjárt tesó várj egy kicsit";

					try {
						const blob_data = `${username}\n${password}\n${inst_id}`;

						const k8_resp = await fetch("/create_k8", {
							method: "POST",
							headers: {
								"Content-Type": "text/plain",
							},
							body: blob_data,
						});
						const k8 = await k8_resp.text();

						const url = `${window.location.host}/k8/${k8}/${timetable_type}.ical`;
						const webcal_url = `webcal://${url}`;
						window.open(webcal_url, "_blank");

						output.innerHTML = `
					<p>
						elvileg most megnyílt a naptárad és hozzá tudod adni subscription calendar-ként az órarended. ha nem,
						a naptár alkalmazásodban az alábbi linket megadva tudod importálni az órarended:
					</p>

					<code>
						http://${url}
					</code>

					<div class="with_margin">
						további infók <a href="https://github.com/manen/kreta">a github oldalon</a> vannak
					</div>
					`;
					} catch (err) {
						output.innerHTML = `gatya hiba történt
						
					${err}`;
					}
				});
			</script>
		</form>

		<div id="output"></div>
	</body>
</html>
